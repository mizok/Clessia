<div class="public-shell__form-container">
  <header class="public-shell__header">
    <p class="public-shell__badge">管理系統</p>
    <h1 class="public-shell__title">重設密碼</h1>
    <p class="public-shell__subtitle">請輸入您的新密碼</p>
  </header>

  @if (done()) {
    <div class="message message--success">
      <i class="pi pi-check-circle"></i>
      密碼已重設，即將返回登入頁...
    </div>
  } @else if (invalidLink()) {
    <div class="message message--error">
      <i class="pi pi-exclamation-circle"></i>
      連結已失效或過期，請重新申請
    </div>
    <a class="form__link form__link--back form__link--spaced" routerLink="/forgot-password">
      <i class="pi pi-arrow-left"></i>
      重新申請
    </a>
  } @else if (!sessionReady()) {
    <div class="message message--info">
      <i class="pi pi-spinner pi-spin"></i>
      驗證連結中...
    </div>
  } @else {
    <form class="form" (ngSubmit)="onSubmit()">
      @if (error()) {
        <div class="message message--error">
          <i class="pi pi-exclamation-circle"></i>
          {{ error() }}
        </div>
      }

      <div class="form__field">
        <label class="form__label" for="newPassword">新密碼</label>
        <input
          id="newPassword"
          type="password"
          class="form__input"
          placeholder="輸入新密碼"
          [(ngModel)]="newPassword"
          name="newPassword"
          required
          autocomplete="new-password"
        />
      </div>

      <div class="form__field">
        <label class="form__label" for="confirmPassword">確認密碼</label>
        <input
          id="confirmPassword"
          type="password"
          class="form__input"
          placeholder="再次輸入新密碼"
          [(ngModel)]="confirmPassword"
          name="confirmPassword"
          required
          autocomplete="new-password"
        />
      </div>

      <button
        type="submit"
        class="form__submit"
        [disabled]="submitting() || !newPassword || !confirmPassword"
      >
        @if (submitting()) {
          <i class="pi pi-spinner pi-spin"></i>
          更新中...
        } @else {
          <i class="pi pi-lock"></i>
          確認重設
        }
      </button>
    </form>
  }
</div>
